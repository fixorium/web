 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FIXORIUM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://raw.githubusercontent.com/fixorium/assets/main/logo.png">
  <meta name="theme-color" content="#7c4d03">
  <!-- Web3.js for EVM wallets -->
  <script src="https://cdn.jsdelivr.net/npm/web3@4.5.0/dist/web3.min.js"></script>
  <!-- WalletConnect for EVM wallet QR support -->
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <!-- 1inch API used for swaps (EVM) -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="custom-brand-bar">ðŸ”¥ Welcome to FIXORIUM - Your Multi-Chain DEX with Ultimate Wallet & Token Variety ðŸ”¥</div>
  <div class="header">
    <div class="logo">
      <img src="https://raw.githubusercontent.com/fixorium/assets/main/logo.png" alt="Fixorium Logo" onerror="this.style.display='none'">
      FIXORIUM
    </div>
    <div>
      <button class="connect-btn" id="connectWalletBtn" style="display:inline-block;">Connect Wallets</button>
      <span id="userAddress" class="wallet-address" style="display:none;"></span>
      <button id="disconnectWalletBtn" class="connect-btn" style="display:none;">Disconnect Wallet</button>
    </div>
  </div>
  <div class="main-content" id="mainContent">
    <div id="fixoriumLogoBox" class="fixorium-logo-box">
      <img src="https://raw.githubusercontent.com/fixorium/assets/main/logo.png" alt="Fixorium Logo" class="fixorium-logo-img" onerror="this.style.display='none'">
      <div class="fixorium-logo-text">FIXORIUM</div>
      <div class="features-list">
        <strong>Platform Features:</strong>
        <ul>
          <li>Multi-chain: Ethereum, BNB Chain, Polygon, Arbitrum, Avalanche, Base, Optimism</li>
          <li>Popular Wallets: MetaMask, Trust, Coinbase, OKX, Bitget, Phantom, WalletConnect</li>
          <li>Swap 1000+ tokens: USDC, USDT, DAI, WBTC, MATIC, BNB, AVAX, ARB, OP, PEPE, SHIB, UNI, LINK, FIXERCOIN & more</li>
          <li>Commercial Branding â€“ <b>Customize with your logo/colors!</b></li>
          <li>Real-time price, gas and balance display</li>
          <li>Fast, secure, and user-friendly</li>
        </ul>
      </div>
    </div>
    <div id="swapSection" class="swap-section" style="display:none;">
      <div class="section-title">Swap DEX Tokens</div>
      <label for="networkSelect">Network</label>
      <select id="networkSelect" class="network-select">
        <option value="1">Ethereum</option>
        <option value="56">BNB Chain</option>
        <option value="137">Polygon</option>
        <option value="42161">Arbitrum</option>
        <option value="43114">Avalanche</option>
        <option value="8453">Base</option>
        <option value="10">Optimism</option>
      </select>
      <label for="amountInput">Amount to Swap</label>
      <input id="amountInput" type="number" min="0" step="any" placeholder="e.g. 1.5"/>
      <label for="fromTokenInput">From Token (address or symbol)</label>
      <input id="fromTokenInput" type="text" placeholder="e.g. USDT or 0xdAC17F958D2ee523a2206206994597C13D831ec7"/>
      <label for="toTokenInput">To Token (address or symbol)</label>
      <input id="toTokenInput" type="text" placeholder="e.g. USDC or 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"/>
      <div class="fee-note"><b>0.03% swap charge apply</b></div>
      <button id="swapBtn" class="swap-btn" disabled>Swap</button>
      <div id="statusBox" class="status info" style="display:none"></div>
      <hr style="margin:20px 0;border:0;border-top:1.5px dashed #dbeafe;">
    </div>
  </div>
  <div class="ad-section center">
    <div class="ad-title">FIXERCOIN - The Future of Digital Value</div>
    <div class="ad-desc">
      Unlock new opportunities with FIXERCOIN! <br>
      Fast, secure, and commercial-grade for your DeFi needs. <br>
      <a href="https://fixercoin.com" target="_blank" style="color:#ffe2b0; text-decoration:underline;">Learn More</a>
    </div>
  </div>
  <div class="popup-bg" id="walletPopupBg">
    <div class="popup" id="walletPopup">
      <div style="font-weight:bold; font-size:1em; margin-bottom:10px;">Select Wallet</div>
      <button class="wallet-popup-btn" id="metamaskBtn">MetaMask</button>
      <button class="wallet-popup-btn" id="phantomBtn">Phantom Wallet</button>
      <button class="wallet-popup-btn" id="trustBtn">Trust Wallet</button>
      <button class="wallet-popup-btn" id="walletConnectBtn">WalletConnect (QR)</button>
      <button class="wallet-popup-btn" id="popupClose">Cancel</button>
    </div>
  </div>
  <script>
    // --- Wallet connection logic ---
    let currentProvider;
    let currentAccount;
    let web3;
    let walletConnectProvider;

    function enableSwapForm(enabled) {
      document.getElementById('swapBtn').disabled = !enabled;
    }

    // MetaMask / Trust
    async function connectMetaMask() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          web3 = new Web3(window.ethereum);
          const accounts = await web3.eth.getAccounts();
          currentAccount = accounts[0];
          document.getElementById('userAddress').innerText = currentAccount;
          document.getElementById('userAddress').style.display = 'inline-block';
          document.getElementById('connectWalletBtn').style.display = 'none';
          document.getElementById('disconnectWalletBtn').style.display = 'inline-block';
          document.getElementById('swapSection').style.display = 'block';
          document.getElementById('walletPopupBg').style.display = 'none';
          currentProvider = 'MetaMask';
          enableSwapForm(true);
        } catch (error) {
          alert('User has denied wallet connection');
        }
      } else {
        alert('MetaMask is not installed.');
      }
    }

    // Phantom - EVM & Solana
    async function connectPhantomWallet() {
      if (window.phantom && window.phantom.solana) {
        try {
          const provider = window.phantom.solana;
          const resp = await provider.connect();
          currentAccount = resp.publicKey.toString();
          document.getElementById('userAddress').innerText = currentAccount;
          document.getElementById('userAddress').style.display = 'inline-block';
          document.getElementById('connectWalletBtn').style.display = 'none';
          document.getElementById('disconnectWalletBtn').style.display = 'inline-block';
          document.getElementById('swapSection').style.display = 'block';
          document.getElementById('walletPopupBg').style.display = 'none';
          currentProvider = 'Phantom';
          enableSwapForm(false); // Solana swap logic not implemented here
        } catch (e) {
          alert('User has denied wallet connection');
        }
      } else {
        // Phantom not installed, show QR code for mobile connect
        openPhantomMobileConnect();
      }
    }

    // Phantom mobile fallback: open Phantom universal link for mobile wallet connect
    function openPhantomMobileConnect() {
      // Phantom deep link for mobile wallet connect
      const connectUrl = "https://phantom.app/ul/v1/connect?app_url=" + encodeURIComponent(window.location.origin);
      window.open(connectUrl, "_blank");
    }

    // Trust Wallet (EVM)
    async function connectTrustWallet() {
      if (window.ethereum && window.ethereum.isTrust) {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          web3 = new Web3(window.ethereum);
          const accounts = await web3.eth.getAccounts();
          currentAccount = accounts[0];
          document.getElementById('userAddress').innerText = currentAccount;
          document.getElementById('userAddress').style.display = 'inline-block';
          document.getElementById('connectWalletBtn').style.display = 'none';
          document.getElementById('disconnectWalletBtn').style.display = 'inline-block';
          document.getElementById('swapSection').style.display = 'block';
          document.getElementById('walletPopupBg').style.display = 'none';
          currentProvider = 'Trust';
          enableSwapForm(true);
        } catch (error) {
          alert('User has denied wallet connection');
        }
      } else {
        alert('Trust Wallet is not installed.');
      }
    }

    // WalletConnect (EVM, QR)
    async function connectWalletConnect() {
      if (walletConnectProvider) {
        await walletConnectProvider.disconnect();
        walletConnectProvider = null;
      }
      walletConnectProvider = new window.WalletConnectProvider.default({
        rpc: {
          1: "https://rpc.ankr.com/eth",
          56: "https://bsc-dataseed.binance.org/",
          137: "https://polygon-rpc.com",
          42161: "https://arb1.arbitrum.io/rpc",
          43114: "https://api.avax.network/ext/bc/C/rpc",
          8453: "https://mainnet.base.org",
          10: "https://mainnet.optimism.io"
        }
      });
      try {
        await walletConnectProvider.enable();
        web3 = new Web3(walletConnectProvider);
        const accounts = await web3.eth.getAccounts();
        currentAccount = accounts[0];
        document.getElementById('userAddress').innerText = currentAccount;
        document.getElementById('userAddress').style.display = 'inline-block';
        document.getElementById('connectWalletBtn').style.display = 'none';
        document.getElementById('disconnectWalletBtn').style.display = 'inline-block';
        document.getElementById('swapSection').style.display = 'block';
        document.getElementById('walletPopupBg').style.display = 'none';
        currentProvider = 'WalletConnect';
        enableSwapForm(true);

        walletConnectProvider.on("accountsChanged", (accounts) => {
          if (accounts.length === 0) {
            disconnectWallet();
          } else {
            currentAccount = accounts[0];
            document.getElementById('userAddress').innerText = currentAccount;
          }
        });
        walletConnectProvider.on("disconnect", () => {
          disconnectWallet();
        });
      } catch (err) {
        alert('User has denied wallet connection');
      }
    }

    function disconnectWallet() {
      document.getElementById('userAddress').innerText = '';
      document.getElementById('userAddress').style.display = 'none';
      document.getElementById('connectWalletBtn').style.display = 'inline-block';
      document.getElementById('disconnectWalletBtn').style.display = 'none';
      document.getElementById('swapSection').style.display = 'none';
      enableSwapForm(false);
      currentProvider = null;
      currentAccount = null;
      web3 = null;
      if (walletConnectProvider) {
        walletConnectProvider.disconnect();
        walletConnectProvider = null;
      }
    }

    document.getElementById('connectWalletBtn').addEventListener('click', () => {
      document.getElementById('walletPopupBg').style.display = 'block';
    });
    document.getElementById('popupClose').addEventListener('click', () => {
      document.getElementById('walletPopupBg').style.display = 'none';
    });
    document.getElementById('metamaskBtn').addEventListener('click', connectMetaMask);
    document.getElementById('phantomBtn').addEventListener('click', connectPhantomWallet);
    document.getElementById('trustBtn').addEventListener('click', connectTrustWallet);
    document.getElementById('walletConnectBtn').addEventListener('click', connectWalletConnect);
    document.getElementById('disconnectWalletBtn').addEventListener('click', disconnectWallet);

    // --- DEX Swap Logic (EVM only, using 1inch API) ---
    document.getElementById('swapBtn').addEventListener('click', async () => {
      const statusBox = document.getElementById('statusBox');
      statusBox.style.display = 'block';
      statusBox.className = 'status info';
      statusBox.textContent = 'Checking token data and preparing swap...';

      // Get user input
      const network = document.getElementById('networkSelect').value;
      const fromToken = document.getElementById('fromTokenInput').value.trim();
      const toToken = document.getElementById('toTokenInput').value.trim();
      const amount = document.getElementById('amountInput').value.trim();

      if (!fromToken || !toToken || !amount || parseFloat(amount) <= 0) {
        statusBox.className = 'status error';
        statusBox.textContent = 'Please fill out all fields with valid values.';
        return;
      }
      if (!currentAccount || !web3) {
        statusBox.className = 'status error';
        statusBox.textContent = 'Connect your EVM wallet first.';
        return;
      }

      try {
        // 1inch API expects token addresses, not symbols
        const fromTokenAddr = fromToken.startsWith('0x') ? fromToken : await getTokenAddress(fromToken, network);
        const toTokenAddr = toToken.startsWith('0x') ? toToken : await getTokenAddress(toToken, network);

        if (!fromTokenAddr || !toTokenAddr) {
          statusBox.className = 'status error';
          statusBox.textContent = 'Invalid token address or symbol.';
          return;
        }

        // Get decimals for input token
        const decimals = await getTokenDecimals(fromTokenAddr);

        // Convert amount to Wei (or token decimals)
        const amountWei = (BigInt(Math.floor(Number(amount) * 10 ** decimals))).toString();

        // Get quote from 1inch API
        statusBox.textContent = 'Requesting best price route from 1inch...';
        const apiBase = get1inchApiBase(network);
        const quoteUrl = `${apiBase}/quote?fromTokenAddress=${fromTokenAddr}&toTokenAddress=${toTokenAddr}&amount=${amountWei}`;
        const quoteRes = await fetch(quoteUrl);
        if (!quoteRes.ok) throw new Error('Failed to get quote');
        const quoteData = await quoteRes.json();

        // Show expected output
        statusBox.className = 'status info';
        statusBox.textContent = `Expected output: ${BigInt(quoteData.toTokenAmount) / BigInt(10 ** quoteData.toToken.decimals)} ${quoteData.toToken.symbol}. Preparing swap...`;

        // Approve if needed (for ERC20)
        if (fromTokenAddr !== '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') {
          const allowanceUrl = `${apiBase}/approve/allowance?tokenAddress=${fromTokenAddr}&walletAddress=${currentAccount}`;
          const allowanceRes = await fetch(allowanceUrl);
          const allowanceData = await allowanceRes.json();
          if (BigInt(allowanceData.allowance) < BigInt(amountWei)) {
            statusBox.textContent = 'Approving token...';
            const approveUrl = `${apiBase}/approve/transaction?tokenAddress=${fromTokenAddr}&amount=${amountWei}`;
            const approveRes = await fetch(approveUrl);
            const approveData = await approveRes.json();
            await web3.eth.sendTransaction({
              from: approveData.from,
              to: approveData.to,
              data: approveData.data,
              value: approveData.value || '0x0'
            });
          }
        }

        // Get swap data from 1inch API
        statusBox.textContent = 'Please confirm the transaction in your wallet...';
        const swapUrl = `${apiBase}/swap?fromTokenAddress=${fromTokenAddr}&toTokenAddress=${toTokenAddr}&amount=${amountWei}&fromAddress=${currentAccount}&slippage=1`;
        const swapRes = await fetch(swapUrl);
        if (!swapRes.ok) throw new Error('Swap API request failed');
        const swapData = await swapRes.json();

        // Send swap tx using web3
        const txParams = {
          from: swapData.tx.from,
          to: swapData.tx.to,
          data: swapData.tx.data,
          value: swapData.tx.value || '0x0',
          gas: swapData.tx.gas || undefined,
        };
        const txHash = await web3.eth.sendTransaction(txParams);
        statusBox.className = 'status success';
        statusBox.textContent = `Swap successful! Tx Hash: ${txHash.transactionHash || txHash}`;
      } catch (e) {
        statusBox.className = 'status error';
        statusBox.textContent = 'Swap failed: ' + (e.message || e);
      }
    });

    // Helper: Get token address by symbol using 1inch token list (main tokens only)
    async function getTokenAddress(symbol, chainId) {
      try {
        const apiBase = get1inchApiBase(chainId);
        const tokensRes = await fetch(`${apiBase}/tokens`);
        const tokens = await tokensRes.json();
        const tokenObj = Object.values(tokens.tokens).find(t => t.symbol.toUpperCase() === symbol.toUpperCase());
        return tokenObj?.address || null;
      } catch (e) {
        return null;
      }
    }

    // Helper: get decimals for a token
    async function getTokenDecimals(tokenAddress) {
      if (tokenAddress === '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') return 18;
      const erc20ABI = [
        { "constant": true, "inputs": [], "name": "decimals", "outputs": [{ "name": "", "type": "uint8" }], "type": "function" }
      ];
      const tokenContract = new web3.eth.Contract(erc20ABI, tokenAddress);
      return await tokenContract.methods.decimals().call();
    }

    // Helper: get 1inch API base url per chain
    function get1inchApiBase(chainId) {
      return `https://api.1inch.dev/swap/v5.2/${chainId}`;
    }
  </script>
</body>
         </html>
